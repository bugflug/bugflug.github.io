!function(){"use strict";const el={check:el=>el instanceof Element||el instanceof DocumentFragment||el instanceof Document,from(el,parent){if(this.check(el))return el;if(parent||(parent=document),"string"==typeof el)return parent.querySelector(el);throw new Error("not a string nor an element! for element "+el+" inside of parent "+parent)},async modify(el,callback,parent){let classList=(el=this.from(el,parent)).classList;return classList.contains("unmodified")||classList.add("unmodified"),classList.remove("unmodified"),await callback(el),classList.add("modified"),el},range(el,parent){if(el instanceof Range)return el;parent=this.from(parent),el=this.from(el,parent);let r=document.createRange();return r.selectNode(el),r}};class Collection{type=void 0;frags=void 0;constructor(frag){this.type=frag}target(parent,target){parent=el.from(parent),this.frags=[];let node=parent.querySelector(target);for(;null!==node;){let f=(new this.type).target(parent,node);this.frags.push(f),node=parent.querySelector(target)}return this}async build(){for(let f in this.frags)await this.frags[f].build();return this}mount(){return this.frags.forEach((f=>f.mount())),this}unmount(){return this.frags.forEach((f=>f.unmount())),this}}const hook={constructor(){},build(){},mount(){},mounted(){},unmount(){},unmounted(){}};class Frag{path="/pages/404.html";hook=hook;frags=[];frag=void 0;parent=void 0;old=void 0;range=void 0;children=void 0;constructor(){this.hook={...hook,...this.hook}}target(parent,target){return this.parent=el.from(parent),this.range=el.range(target,this.parent),this.old=this.range.extractContents(),this}async build(){this.frag=document.createRange().createContextualFragment(await fetch(this.path).then((data=>data.text()))),this.frags&&(this.children=[]);for(let tag in this.frags){let c=await new Collection(this.frags[tag]).target(this.frag,tag).build();this.children.push(c)}return this.hook.build&&this.hook.build(this),this}mount(){return this.hook.mount&&this.hook.mount(this),this.children.forEach((c=>c.mount())),this.range.insertNode(this.frag),this.parent.classList&&this.parent.classList.add("mounted"),this.hook.mounted&&this.hook.mounted(this),this.frag=void 0,this}unmount(){if(!this.range)throw new Error("this frag has no range to unmount!");return!!this.parent&&(this.hook.unmount&&this.hook.unmount(this),this.children.forEach((c=>c.unmount())),this.frag=this.range.extractContents(),this.range.insertNode(this.old),this.parent.classList&&this.parent.classList.remove("mounted"),this.hook.unmounted&&this.hook.unmounted(this),this.old=void 0,this)}}class Page extends Frag{static href="/404";static name=void 0;static hidden=!1}let router;class Router{container;view;routes={};page={unmount:()=>{}};constructor(routes){if(router)throw new Error("a router already exists for this document!");this.update=this.update.bind(this),window.route=this.route,window.router=router=this,window.onpopstate=this.update,routes.forEach((r=>this.routes[r.href]=r))}target(container,view){return this.container=el.from(container||"main"),this.view=el.range(view||"view",this.container),this.view.deleteContents(),this.container.id="router",this}async update(url){return""===(url=url||window.location.pathname)&&(url="/"),this.page.unmount(),this.container.innerHTML="",(new(this.routes[url]||this.routes["/404"])).target(this.container,this.view).build().then((f=>f.mount())).then((f=>this.page=f)),this}route(event){return(event=event||window.EventSource).preventDefault(),window.location.pathname!==(event.target.pathname||"/")&&(window.history.pushState({},"",event.target.href||"/"),this.update()),this}}const config_accounts={twitch:{url:"twitch.tv/bugflug",name:"bugflug"},youtube:{url:"youtube.com/@bugflug",name:"bugflug"},steam:{url:"steamcommunity.com/profiles/76561198081991204",name:"bugflug"}};class FragAccounts extends Frag{path="/frags/accounts.html";hook={build(f){el.modify(".accounts",(el=>{for(let site in config_accounts){let a=document.createElement("a");a.href="https://"+config_accounts[site].url,a.appendChild(document.createTextNode(site)),el.appendChild(a)}}),f.frag)}}}const shuffle=array=>{if(array.constructor===Array)for(let i=array.length-1;i>0;i--){const rand=Math.floor(Math.random()*(i+1)),temp=array[i];array[i]=array[rand],array[rand]=temp}return array};class FragTitle extends Frag{static title="bugflug".split("");static colors=shuffle(["#ff306c","#ad005f","#e04f0b","#ffa200","#ffe74c","#ebffd4","#48ff00","#00cf2d","#31d4e0","#006ec2","#1629f7","#450073","#8e1cc7","#f018f0"]);path="/frags/title.html";constructor(){for(;FragTitle.colors.length<FragTitle.title.length;)FragTitle.colors=shuffle(FragTitle.colors.concat(FragTitle.colors));let last;FragTitle.colors.filter((c=>{let t=!(c===last);return last=c,t})),super()}hook={build(f){el.modify(".title",(el=>{let index=0,delay=0;FragTitle.title.forEach((char=>{let span=document.createElement("span");span.appendChild(document.createTextNode(char)),span.style.color=FragTitle.colors[index],index++,span.style.animationDelay=delay+"s",delay+=.3,el.appendChild(span)}))}),f.frag)}}}const routes=[class extends Page{static href="/404";path="/pages/404.html"},class extends Page{static href="/";static name="home";path="/pages/home.html";frags={title:FragTitle,accounts:FragAccounts,pages:FragPages};hook={mounted(_){const streamWrapper=document.querySelector("#stream-wrapper"),streamContainer=document.querySelector("#stream"),player=new Twitch.Player("stream",{channel:config_accounts.twitch.name,width:1280,height:720,muted:"true"});player.addEventListener(Twitch.Player.READY,(()=>{player.addEventListener(Twitch.Player.ONLINE,(()=>{player.addEventListener(Twitch.Player.PLAYING,(()=>{player.setVolume(.2),player.setMuted(!1),streamWrapper.classList.remove("hidden"),streamWrapper.classList.add("show")}))})),player.addEventListener(Twitch.Player.OFFLINE,(()=>{streamContainer.innerHTML=""}))}))}}}];class FragPages extends Frag{path="/frags/pages.html";hook={build(f){el.modify(".pages",(el=>{routes.forEach((r=>{let a=document.createElement("a");a.href=r.href,a.appendChild(document.createTextNode(r.name||r.href)),a.addEventListener("click",(event=>router.route(event))),el.appendChild(a)}))}),f.frag)}}}class FragSidebar extends Frag{static instances=[];static show(){FragSidebar.instances.forEach((f=>el.modify(".sidebar:not(.show)",(el=>el.classList.add("show")),f.frag||f.parent)))}static hide(){FragSidebar.instances.forEach((f=>el.modify(".sidebar.show",(el=>el.classList.remove("show")),f.frag||f.parent)))}path="/frags/sidebar.html";frags={accounts:FragAccounts,pages:FragPages,title:FragTitle};hook={mounted(f){FragSidebar.instances.push(f)},unmounted(f){FragSidebar.instances.splice(this.instances.indexOf(f,1))}}}const init=()=>{"loading"!==document.readyState?((new FragSidebar).target("body","sidebar").build().then((f=>{f.mount()})),new Router(routes).target("main","view").update()):document.addEventListener("DOMContentLoaded",init)};init()}();