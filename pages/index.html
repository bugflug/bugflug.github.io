<!-- markup -->
<script>appendComponent('main', '/components/info.html')</script>
<div id="stream-wrapper" class="hidden">
    <div id="stream"></div>
</div>

<!-- style -->
<style>
    main {
        /* layout */
        padding: 20vh 0 0 0;
        /* grid */
        display: flex;
        flex-direction: column;
    }
    @media only screen and (min-width: 1080px) { main {
        /* layout */
        padding: 16rem 0 0 0;
    }}
    @media only screen and (min-width: 720px) and (max-width: 1079px) { main {
        /* layout */
        padding: 8rem 0 0 0;
    }}
    @media only screen and (max-width: 719px) { main {
        /* layout */
        padding: 0 2rem 0 2rem;
    }}

    #info-spacer .info {
        /* layout */
        opacity: 0;
    }

    #stream-wrapper {
        /* anim */
        transition: opacity 0.2s ease, max-height 1s ease;
    }
    #stream-wrapper.show {
        /* layout */
        opacity: 1;
        height: auto;
        max-height: 100%;
    }
    #stream-wrapper.hidden {
        /* layout */
        opacity: 0;
        height: 0;
        max-height: 0;
    }

    #stream {
        /* layout */
        max-width: 100%;
        max-height: 100%;
    }

    #stream > iframe {
        /* colors */
        background-color: var(--color-fg);
        /* layout */
        position: relative;
        aspect-ratio: 16 / 9;
        max-width: 100%;
        max-height: 30vh;
    }
</style>

<!-- script -->
<script src="https://player.twitch.tv/js/embed/v1.js"></script>
<script type="module">
    import { config } from '../src/config.js'

    const streamWrapper = document.querySelector('#stream-wrapper')
    const streamContainer = document.querySelector('#stream')

    const player = new Twitch.Player('stream', {
        channel: config.accountNames.twitch,
        width: 1280,
        height: 720,
        muted: 'true'
    })

    // wait for the proper responses to show/hide
    player.addEventListener(Twitch.Player.READY, () => {
        player.addEventListener(Twitch.Player.ONLINE, () => {
            player.addEventListener(Twitch.Player.PLAYING, () => {
                player.setVolume(0.2)
                player.setMuted(false)
                streamWrapper.classList.remove('hidden')
                streamWrapper.classList.add('show')
            })
        })
        player.addEventListener(Twitch.Player.OFFLINE, () => {
            streamContainer.innerHTML = ''
        })
    })
</script>